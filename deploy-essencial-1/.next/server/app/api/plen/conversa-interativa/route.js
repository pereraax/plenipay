"use strict";(()=>{var a={};a.id=9189,a.ids=[9189],a.modules={72934:a=>{a.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:a=>{a.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:a=>{a.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},91363:(a,e,r)=>{r.r(e),r.d(e,{headerHooks:()=>v,originalPathname:()=>U,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>x});var o={};r.r(o),r.d(o,{POST:()=>c});var t=r(95419),i=r(69108),s=r(99678),n=r(78070),d=r(81664),p=r(40315),u=r(91433);async function c(a){try{let e=await (0,d.eI)(),{data:{user:r}}=await e.auth.getUser();if(!r)return n.Z.json({error:"N\xe3o autenticado"},{status:401});let{mensagem:o,estadoAtual:t}=await a.json();if(!o||"string"!=typeof o)return n.Z.json({error:"Mensagem inv\xe1lida"},{status:400});await (0,p.cu)();let i=await (0,p.$s)(),s=t||{etapa:"inicio",dados:{}},c=function(a,e,r){let o=a.toLowerCase().trim();switch(e.etapa){case"inicio":if(o.includes("registrar")||o.includes("criar")||o.includes("adicionar"))return{proximaEtapa:"tipo",pergunta:"Perfeito! Vamos criar um registro. \xc9 uma entrada ou uma sa\xedda?"};return{proximaEtapa:"inicio",pergunta:"Ol\xe1! Como posso ajudar? Voc\xea pode me pedir para registrar um gasto ou uma entrada."};case"tipo":if(o.includes("entrada")||o.includes("receita")||o.includes("recebido")||o.includes("ganho"))return{proximaEtapa:"valor",pergunta:"\xd3timo! Qual \xe9 o valor dessa entrada?",dados:{tipo:"entrada"}};if(o.includes("saida")||o.includes("gasto")||o.includes("despesa")||o.includes("pago"))return{proximaEtapa:"valor",pergunta:"Entendi! Qual \xe9 o valor desse gasto?",dados:{tipo:"saida"}};return{proximaEtapa:"tipo",pergunta:"Por favor, me diga se \xe9 uma entrada (dinheiro recebido) ou uma sa\xedda (gasto)."};case"valor":let t=null;for(let e of[/r\$\s*([\d.,]+)/i,/([\d.,]+)\s*reais?/i,/([\d.,]+)\s*r\$/i,/([\d.,]+)/i]){let r=a.match(e);if(r){let a=parseFloat((r[1]||r[0]).replace(/\./g,"").replace(",","."));if(!isNaN(a)&&a>0){t=a;break}}}if(t){if("entrada"===e.dados.tipo&&!r.podeRegistrarSalario)return{proximaEtapa:"tipo",pergunta:"Desculpe, registrar entradas requer um plano b\xe1sico ou premium. Voc\xea pode registrar apenas sa\xeddas no plano teste. Vamos registrar uma sa\xedda?"};let a="entrada"===e.dados.tipo?"sal\xe1rio, venda, presente, outros":"alimenta\xe7\xe3o, transporte, moradia, compras, sa\xfade, educa\xe7\xe3o, trabalho, entretenimento, fitness, viagem, outros";return{proximaEtapa:"categoria",pergunta:`Valor de R$ ${t.toLocaleString("pt-BR",{minimumFractionDigits:2})} registrado! Qual \xe9 a categoria? Op\xe7\xf5es: ${a}`,dados:{valor:t}}}return{proximaEtapa:"valor",pergunta:"N\xe3o entendi o valor. Por favor, diga o valor em reais, por exemplo: cinquenta reais ou R$ 50,00."};case"categoria":let i="entrada"===e.dados.tipo?["sal\xe1rio","salario","venda","presente","outros"]:["alimenta\xe7\xe3o","alimentacao","transporte","moradia","compras","sa\xfade","saude","educa\xe7\xe3o","educacao","trabalho","entretenimento","fitness","viagem","outros"],s="outros";for(let a of i)if(o.includes(a)){s="salario"===a?"sal\xe1rio":"alimentacao"===a?"alimenta\xe7\xe3o":"saude"===a?"sa\xfade":"educacao"===a?"educa\xe7\xe3o":a;break}return{proximaEtapa:"data",pergunta:`Categoria "${s}" registrada! Qual \xe9 a data? Voc\xea pode dizer "hoje", "ontem" ou uma data espec\xedfica.`,dados:{categoria:s}};case"data":let n=new Date;if(o.includes("hoje")||o.includes("agora"))n=new Date;else if(o.includes("ontem"))(n=new Date).setDate(n.getDate()-1);else{let e=a.match(/(\d{1,2})\/(\d{1,2})(?:\/(\d{4}))?/);if(e){let a=parseInt(e[1]),r=parseInt(e[2])-1;n=new Date(e[3]?parseInt(e[3]):new Date().getFullYear(),r,a)}}return{proximaEtapa:"confirmacao",pergunta:`Data registrada! Vou criar um ${"entrada"===e.dados.tipo?"registro de entrada":"registro de gasto"} de R$ ${e.dados.valor?.toLocaleString("pt-BR",{minimumFractionDigits:2})} na categoria "${e.dados.categoria}" para ${n.toLocaleDateString("pt-BR")}. Posso confirmar?`,dados:{data:n.toISOString()}};case"confirmacao":if(o.includes("sim")||o.includes("confirmar")||o.includes("pode")||o.includes("ok"))return{proximaEtapa:"completo",pergunta:"Perfeito! Registro criado com sucesso! Mais alguma coisa?"};if(o.includes("n\xe3o")||o.includes("nao")||o.includes("cancelar"))return{proximaEtapa:"inicio",pergunta:"Entendido, registro cancelado. Como posso ajudar?"};return{proximaEtapa:"confirmacao",pergunta:'Por favor, confirme dizendo "sim" para criar o registro ou "n\xe3o" para cancelar.'};default:return{proximaEtapa:"inicio",pergunta:"Como posso ajudar?"}}}(o,s,i),l={etapa:c.proximaEtapa,dados:{...s.dados,...c.dados}},m=!1;if("completo"===c.proximaEtapa&&l.dados.tipo&&l.dados.valor){let a=new FormData;a.append("nome",l.dados.nome||`Registro via PLEN - ${l.dados.categoria||"outros"}`),a.append("tipo",l.dados.tipo),a.append("valor",l.dados.valor.toString()),a.append("categoria",l.dados.categoria||"outros"),a.append("data_registro",l.dados.data||new Date().toISOString()),a.append("metodo_pagamento","dinheiro"),a.append("parcelas_totais","1"),a.append("parcelas_pagas","0");let e=await (0,u.criarRegistro)(a);if(e.error)return n.Z.json({resposta:`Desculpe, ocorreu um erro ao criar o registro: ${e.error}`,estado:l,erro:!0});m=!0}return n.Z.json({resposta:c.pergunta,estado:l,registroCriado:m})}catch(a){return console.error("Erro na conversa interativa:",a),n.Z.json({error:a.message||"Erro ao processar mensagem"},{status:500})}}let l=new t.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/plen/conversa-interativa/route",pathname:"/api/plen/conversa-interativa",filename:"route",bundlePath:"app/api/plen/conversa-interativa/route"},resolvedPagePath:"/Users/charllestabordas/Documents/SISTEMA DE CONTAS/app/api/plen/conversa-interativa/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:f,headerHooks:v,staticGenerationBailout:x}=l,U="/api/plen/conversa-interativa/route";function w(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},40315:(a,e,r)=>{r.d(e,{$s:()=>d,cu:()=>n});var o=r(74471);r(68616);var t=r(81664),i=r(42053);let s={teste:{podeCriarRegistros:!0,limiteRegistrosMensais:50,podeCriarDividas:!1,podeCriarEmprestimos:!1,podeRegistrarSalario:!1,podeUsarCalendario:!1,podeUsarMetas:!1,limiteMetas:0,podeUsarDashboard:!0,podeUsarDashboardAvancado:!1,podeExportarRelatorios:!1,podeExportarAvancado:!1,podeCriarUsuarios:!0,limiteUsuarios:2,podeUploadDocumentos:!1,podeUsarGameDinamico:!1,podeUsarFiltrosAvancados:!1},basico:{podeCriarRegistros:!0,limiteRegistrosMensais:null,podeCriarDividas:!0,podeCriarEmprestimos:!1,podeRegistrarSalario:!0,podeUsarCalendario:!0,podeUsarMetas:!0,limiteMetas:3,podeUsarDashboard:!0,podeUsarDashboardAvancado:!1,podeExportarRelatorios:!0,podeExportarAvancado:!1,podeCriarUsuarios:!0,limiteUsuarios:10,podeUploadDocumentos:!1,podeUsarGameDinamico:!1,podeUsarFiltrosAvancados:!0},premium:{podeCriarRegistros:!0,limiteRegistrosMensais:null,podeCriarDividas:!0,podeCriarEmprestimos:!0,podeRegistrarSalario:!0,podeUsarCalendario:!0,podeUsarMetas:!0,limiteMetas:null,podeUsarDashboard:!0,podeUsarDashboardAvancado:!0,podeExportarRelatorios:!0,podeExportarAvancado:!0,podeCriarUsuarios:!0,limiteUsuarios:null,podeUploadDocumentos:!0,podeUsarGameDinamico:!0,podeUsarFiltrosAvancados:!0}};async function n(){let a=await (0,t.eI)(),{data:{user:e}}=await a.auth.getUser();if(!e)return"teste";let{data:r}=await a.from("profiles").select("plano, plano_status, plano_data_fim").eq("id",e.id).single();if(!r||"teste"===r.plano)return"teste";if(("basico"===r.plano||"premium"===r.plano)&&"ativo"===r.plano_status){let a=r.plano_data_fim?new Date(r.plano_data_fim):null;if(a&&a>new Date)return r.plano}return"teste"}async function d(){return s[await n()]}async function p(a,e){return!!s[e][a]}async function u(){let a=await d();if(!a.podeCriarRegistros)return{pode:!1,motivo:"Cria\xe7\xe3o de registros n\xe3o dispon\xedvel no seu plano"};if(null===a.limiteRegistrosMensais)return{pode:!0};let e=await (0,t.eI)(),{data:{user:r}}=await e.auth.getUser();if(!r)return{pode:!1,motivo:"Usu\xe1rio n\xe3o autenticado"};let{data:o}=await e.from("profiles").select("registros_mes_atual, registros_mes_referencia").eq("id",r.id).single();if(!o)return{pode:!1,motivo:"Perfil n\xe3o encontrado"};let i=new Date().getMonth(),s=o.registros_mes_referencia?new Date(o.registros_mes_referencia).getMonth():i;return(i===s&&o.registros_mes_atual||0)>=a.limiteRegistrosMensais?{pode:!1,motivo:`Limite de ${a.limiteRegistrosMensais} registros/m\xeas atingido. Fa\xe7a upgrade para criar registros ilimitados.`}:{pode:!0}}async function c(){let a=await d();if(!a.podeCriarUsuarios)return{pode:!1,motivo:"Cria\xe7\xe3o de usu\xe1rios n\xe3o dispon\xedvel no seu plano"};if(null===a.limiteUsuarios)return{pode:!0};let e=await (0,t.eI)(),{data:{user:r}}=await e.auth.getUser();if(!r)return{pode:!1,motivo:"Usu\xe1rio n\xe3o autenticado"};let{data:o,error:i}=await e.from("users").select("id",{count:"exact"}).eq("account_owner_id",r.id);return i?{pode:!1,motivo:"Erro ao verificar usu\xe1rios"}:(o?.length||0)>=a.limiteUsuarios?{pode:!1,motivo:`Limite de ${a.limiteUsuarios} usu\xe1rios atingido. Fa\xe7a upgrade para criar usu\xe1rios ilimitados.`}:{pode:!0}}async function l(){let a=await d();if(!a.podeUsarMetas)return{pode:!1,motivo:"Sistema de metas n\xe3o dispon\xedvel no seu plano"};if(null===a.limiteMetas)return{pode:!0};let e=await (0,t.eI)(),{data:{user:r}}=await e.auth.getUser();if(!r)return{pode:!1,motivo:"Usu\xe1rio n\xe3o autenticado"};let{data:o,error:i}=await e.from("metas_cofrinho").select("id",{count:"exact"}).eq("user_id",r.id);return i?{pode:!1,motivo:"Erro ao verificar metas"}:(o?.length||0)>=a.limiteMetas?{pode:!1,motivo:`Limite de ${a.limiteMetas} metas atingido. Fa\xe7a upgrade para criar metas ilimitadas.`}:{pode:!0}}async function m(){let a=await (0,t.eI)(),{data:{user:e}}=await a.auth.getUser();e&&await a.rpc("incrementar_registro_mes",{user_uuid:e.id})}(0,i.h)([n,d,p,u,c,l,m]),(0,o.U)("1d9dce1d8eaec2e7f58e2d9eda7739f1f0b3c8fc",n),(0,o.U)("170426fcf1af55fd7863ddfb6ff4ec4727fe103a",d),(0,o.U)("94e9e16406b889792a57d5d69a46df486672234b",p),(0,o.U)("3383cdbdca0be93cedc5ff8dc965a6bd4857f22d",u),(0,o.U)("7793bfdc3973517ebedb0f54256adb3ab8f93d1e",c),(0,o.U)("7414d46d3794bfd725aa62e8dd77277b20115e42",l),(0,o.U)("4fdf752be30fe3bed32fec8fef91f1643800bcbe",m)},50482:(a,e,r)=>{a.exports=r(20399)},25091:(a,e,r)=>{a.exports=r(50482).vendored["react-rsc"].ReactDOM},18195:(a,e,r)=>{a.exports=r(50482).vendored["react-rsc"].ReactServerDOMWebpackServerEdge},40002:(a,e,r)=>{a.exports=r(50482).vendored["react-rsc"].React},95419:(a,e,r)=>{a.exports=r(30517)}};var e=require("../../../../webpack-runtime.js");e.C(a);var r=a=>e(e.s=a),o=e.X(0,[1638,2455,4128,7497,8070,6864,4819,1433],()=>r(91363));module.exports=o})();