"use strict";(()=>{var e={};e.id=2583,e.ids=[2583],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},80735:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>y,originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>w});var r={};a.r(r),a.d(r,{POST:()=>p});var o=a(95419),i=a(69108),n=a(99678),s=a(78070),l=a(24698),d=a(94128);let c=process.env.SUPABASE_SERVICE_ROLE_KEY;async function p(e){try{let t=await (0,l.W)();if(!t)return s.Z.json({error:"N\xe3o autorizado"},{status:401});let{userId:a,plano:r,planoStatus:o}=await e.json();if(!a||!r)return s.Z.json({error:"userId e plano s\xe3o obrigat\xf3rios"},{status:400});if(!["teste","basico","premium"].includes(r))return s.Z.json({error:"Plano inv\xe1lido. Use: teste, basico ou premium"},{status:400});let i=c?(0,d.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co",c,{auth:{autoRefreshToken:!1,persistSession:!1}}):null;if(!i)return s.Z.json({error:"Configura\xe7\xe3o do servidor incompleta"},{status:500});let n=null,p=null,u=o||"trial";"basico"===r||"premium"===r?(n=new Date,(p=new Date).setMonth(p.getMonth()+1),u=o||"ativo"):u="trial";let{data:f,error:h}=await i.from("profiles").update({plano:r,plano_status:u,plano_data_inicio:n?n.toISOString():null,plano_data_fim:p?p.toISOString():null,updated_at:new Date().toISOString()}).eq("id",a).select().single();if(h)return console.error("Erro ao atualizar plano:",h),s.Z.json({error:"Erro ao atualizar plano: "+h.message},{status:500});return console.log("âœ… Plano alterado com sucesso:",{userId:a,plano:r,status:u,adminId:t.id,adminEmail:t.email}),s.Z.json({success:!0,message:`Plano alterado para ${r} com sucesso!`,usuario:{id:f.id,plano:f.plano,plano_status:f.plano_status}})}catch(e){return console.error("Erro ao alterar plano:",e),s.Z.json({error:e.message||"Erro ao alterar plano"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/alterar-plano/route",pathname:"/api/admin/alterar-plano",filename:"route",bundlePath:"app/api/admin/alterar-plano/route"},resolvedPagePath:"/Users/charllestabordas/Documents/SISTEMA DE CONTAS/app/api/admin/alterar-plano/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:y,staticGenerationBailout:w}=u,g="/api/admin/alterar-plano/route";function v(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},24698:(e,t,a)=>{a.d(t,{W:()=>n});var r=a(32455),o=a(24961);a(78070);let i=new TextEncoder().encode(process.env.ADMIN_JWT_SECRET||"your-secret-key-change-in-production");async function n(){try{let e=await (0,r.cookies)(),t=e.get("admin_token")?.value;if(!t)return null;let{payload:a}=await (0,o._)(t,i);return{id:a.id,email:a.email,nome:a.nome}}catch(e){return null}}},95419:(e,t,a)=>{e.exports=a(30517)},24961:(e,t,a)=>{a.d(t,{_:()=>T});var r=a(1840),o=a(6005),i=a(47261),n=a(45452),s=a(80190),l=a(46508),d=a(34907);let c=(0,i.promisify)(o.verify),p=async(e,t,a,r)=>{let i=(0,d.Z)(e,t,"verify");if(e.startsWith("HS")){let t=await (0,l.Z)(e,i,r);try{return o.timingSafeEqual(a,t)}catch{return!1}}let p=(0,n.Z)(e),u=(0,s.Z)(e,i);try{return await c(p,r,u,a)}catch{return!1}};var u=a(30979),f=a(11798),h=a(72062),m=a(19233),y=a(90927),w=a(71081);let g=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};var v=a(6598);let b=e=>e.d?(0,o.createPrivateKey)({format:"jwk",key:e}):(0,o.createPublicKey)({format:"jwk",key:e});async function S(e,t){if(!(0,m.Z)(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return(0,r.Jx)(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new u.jq('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return b({...e,alg:t});default:throw new u.jq('Unsupported "kty" (Key Type) Parameter value')}}async function x(e,t,a){let o,i;if(!(0,m.Z)(e))throw new u.GW("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new u.GW('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new u.GW("JWS Protected Header incorrect type");if(void 0===e.payload)throw new u.GW("JWS Payload missing");if("string"!=typeof e.signature)throw new u.GW("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,m.Z)(e.header))throw new u.GW("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{let t=(0,r.Jx)(e.protected);n=JSON.parse(f.xv.decode(t))}catch{throw new u.GW("JWS Protected Header is invalid")}if(!(0,h.Z)(n,e.header))throw new u.GW("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...n,...e.header},l=(0,w.Z)(u.GW,new Map([["b64",!0]]),a?.crit,n,s),d=!0;if(l.has("b64")&&"boolean"!=typeof(d=n.b64))throw new u.GW('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:c}=s;if("string"!=typeof c||!c)throw new u.GW('JWS "alg" (Algorithm) Header Parameter missing or invalid');let b=a&&g("algorithms",a.algorithms);if(b&&!b.has(c))throw new u.FP('"alg" (Algorithm) Header Parameter value not allowed');if(d){if("string"!=typeof e.payload)throw new u.GW("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new u.GW("JWS Payload must be a string or an Uint8Array instance");let x=!1;"function"==typeof t?(t=await t(n,e),x=!0,(0,y.Y)(c,t,"verify"),(0,v.x)(t)&&(t=await S(t,c))):(0,y.Y)(c,t,"verify");let W=(0,f.zo)(f.g7.encode(e.protected??""),f.g7.encode("."),"string"==typeof e.payload?f.g7.encode(e.payload):e.payload);try{o=(0,r.Jx)(e.signature)}catch{throw new u.GW("Failed to base64url decode the signature")}if(!await p(c,t,o,W))throw new u.nx;if(d)try{i=(0,r.Jx)(e.payload)}catch{throw new u.GW("Failed to base64url decode the payload")}else i="string"==typeof e.payload?f.g7.encode(e.payload):e.payload;let k={payload:i};return(void 0!==e.protected&&(k.protectedHeader=n),void 0!==e.header&&(k.unprotectedHeader=e.header),x)?{...k,key:t}:k}async function W(e,t,a){if(e instanceof Uint8Array&&(e=f.xv.decode(e)),"string"!=typeof e)throw new u.GW("Compact JWS must be a string or Uint8Array");let{0:r,1:o,2:i,length:n}=e.split(".");if(3!==n)throw new u.GW("Invalid Compact JWS");let s=await x({payload:o,protected:r,signature:i},t,a),l={payload:s.payload,protectedHeader:s.protectedHeader};return"function"==typeof t?{...l,key:s.key}:l}var k=a(25331),P=a(5653);let J=e=>e.toLowerCase().replace(/^application\//,""),_=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),A=(e,t,a={})=>{let r,o;try{r=JSON.parse(f.xv.decode(t))}catch{}if(!(0,m.Z)(r))throw new u.uv("JWT Claims Set must be a top-level JSON object");let{typ:i}=a;if(i&&("string"!=typeof e.typ||J(e.typ)!==J(i)))throw new u.YS('unexpected "typ" JWT header value',r,"typ","check_failed");let{requiredClaims:n=[],issuer:s,subject:l,audience:d,maxTokenAge:c}=a,p=[...n];for(let e of(void 0!==c&&p.push("iat"),void 0!==d&&p.push("aud"),void 0!==l&&p.push("sub"),void 0!==s&&p.push("iss"),new Set(p.reverse())))if(!(e in r))throw new u.YS(`missing required "${e}" claim`,r,e,"missing");if(s&&!(Array.isArray(s)?s:[s]).includes(r.iss))throw new u.YS('unexpected "iss" claim value',r,"iss","check_failed");if(l&&r.sub!==l)throw new u.YS('unexpected "sub" claim value',r,"sub","check_failed");if(d&&!_(r.aud,"string"==typeof d?[d]:d))throw new u.YS('unexpected "aud" claim value',r,"aud","check_failed");switch(typeof a.clockTolerance){case"string":o=(0,P.Z)(a.clockTolerance);break;case"number":o=a.clockTolerance;break;case"undefined":o=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:h}=a,y=(0,k.Z)(h||new Date);if((void 0!==r.iat||c)&&"number"!=typeof r.iat)throw new u.YS('"iat" claim must be a number',r,"iat","invalid");if(void 0!==r.nbf){if("number"!=typeof r.nbf)throw new u.YS('"nbf" claim must be a number',r,"nbf","invalid");if(r.nbf>y+o)throw new u.YS('"nbf" claim timestamp check failed',r,"nbf","check_failed")}if(void 0!==r.exp){if("number"!=typeof r.exp)throw new u.YS('"exp" claim must be a number',r,"exp","invalid");if(r.exp<=y-o)throw new u.fy('"exp" claim timestamp check failed',r,"exp","check_failed")}if(c){let e=y-r.iat;if(e-o>("number"==typeof c?c:(0,P.Z)(c)))throw new u.fy('"iat" claim timestamp check failed (too far in the past)',r,"iat","check_failed");if(e<0-o)throw new u.YS('"iat" claim timestamp check failed (it should be in the past)',r,"iat","check_failed")}return r};async function T(e,t,a){let r=await W(e,t,a);if(r.protectedHeader.crit?.includes("b64")&&!1===r.protectedHeader.b64)throw new u.uv("JWTs MUST NOT use unencoded payload");let o={payload:A(r.protectedHeader,r.payload,a),protectedHeader:r.protectedHeader};return"function"==typeof t?{...o,key:r.key}:o}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[1638,2455,4128,8070,5164],()=>a(80735));module.exports=r})();