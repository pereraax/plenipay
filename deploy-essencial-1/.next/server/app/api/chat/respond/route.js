"use strict";(()=>{var e={};e.id=1279,e.ids=[1279],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},33762:(e,a,r)=>{r.r(a),r.d(a,{headerHooks:()=>g,originalPathname:()=>v,patchFetch:()=>I,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var o={};r.r(o),r.d(o,{POST:()=>l});var s=r(95419),n=r(69108),t=r(99678),i=r(81664),c=r(78070);async function l(e){try{let a=await (0,i.eI)(),{data:{user:r}}=await a.auth.getUser();if(!r)return c.Z.json({error:"N\xe3o autenticado"},{status:401});let{user_id:o,message:s}=await e.json();if(!o||!s||!s.trim())return c.Z.json({error:"user_id e message s\xe3o obrigat\xf3rios"},{status:400});let{data:n,error:t}=await a.from("chat_conversations").select("closed_at, assigned_agent_name, updated_at, is_closed").eq("user_id",o).maybeSingle();t&&"PGRST116"!==t.code&&console.error("Erro ao buscar conversa:",t);let l=!1;n?n.assigned_agent_name&&null!==n.assigned_agent_name?console.log("ℹ️ Conversa j\xe1 tem nome atribu\xeddo:",n.assigned_agent_name):(l=!0,console.log("✅ Conversa sem nome atribu\xeddo - gerando novo nome")):(l=!0,console.log("✅ Primeira conversa detectada - gerando novo nome"));let d=null;if(l){d=function(){let e=["Jo\xe3o","Maria","Jos\xe9","Ana","Carlos","Fernanda","Paulo","Juliana","Ricardo","Mariana","Pedro","Carla","Lucas","Beatriz","Rodrigo","Gabriela","Bruno","Amanda","Thiago","Larissa","Felipe","Patricia","Rafael","Camila","Andr\xe9","Vanessa","Marcos","Daniela","Gustavo","Isabela","Renato","Priscila","Diego","Juliana","Eduardo","Fernanda","Vinicius","Mariana","Gabriel","Bruna","Henrique","Nat\xe1lia","Matheus","Tatiana","Leonardo","Renata","Samuel","Cristina","Alexandre","Leticia","Fabio","Adriana","Daniel","Simone","Antonio","Sandra","Ronaldo","Monica","Wagner","Roberta","Fernando","Silvia","Marcelo","Lucia"],a=["Silva","Santos","Oliveira","Souza","Rodrigues","Ferreira","Alves","Pereira","Lima","Gomes","Ribeiro","Carvalho","Almeida","Costa","Martins","Mendes","Barbosa","Rocha","Reis","Ara\xfajo","Monteiro","Moraes","Nascimento","Ramos","Campos","Teixeira","Cardoso","Duarte","Cavalcanti","Freitas","Mendes","Pinto","Machado","Correia","Dias","Lopes","Moreira","Castro","Batista","Fernandes","Vieira","Nunes","Farias","Barros","Cunha","Cruz","Nogueira","Machado"],r=e[Math.floor(Math.random()*e.length)],o=a[Math.floor(Math.random()*a.length)];return`${r} ${o}`}(),console.log("\uD83C\uDFB2 Nome gerado:",d);try{if(n){let{error:e}=await a.from("chat_conversations").update({assigned_agent_name:d,is_closed:!1}).eq("user_id",o);e?console.error("❌ Erro ao atualizar nome do atendente:",e.message,e.code):console.log("✅ Novo nome de atendente atribu\xeddo para conversa:",d)}else{let e={user_id:o,is_closed:!1,assigned_agent_name:d},{error:r}=await a.from("chat_conversations").insert([e]);if(r){console.error("❌ Erro ao inserir com assigned_agent_name:",r.message,r.code);let{error:e}=await a.from("chat_conversations").insert([{user_id:o,is_closed:!1}]);e&&console.error("❌ Erro ao inserir conversa sem nome:",e.message)}else console.log("✅ Novo nome de atendente atribu\xeddo:",d)}}catch(e){console.error("❌ Erro ao salvar nome do atendente:",e?.message||e)}}else n?.assigned_agent_name&&(d=n.assigned_agent_name,console.log("ℹ️ Usando nome existente:",d));let{data:u,error:m}=await a.from("chat_messages").insert([{user_id:o,message:s.trim(),sender_type:"support",is_read:!1}]).select().single();if(m)return console.error("Erro ao salvar resposta:",m),c.Z.json({error:"Erro ao enviar resposta"},{status:500});return c.Z.json({success:!0,data:u,assignedAgentName:d||n?.assigned_agent_name||null})}catch(e){return console.error("Erro inesperado:",e),c.Z.json({error:"Erro inesperado ao enviar resposta"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chat/respond/route",pathname:"/api/chat/respond",filename:"route",bundlePath:"app/api/chat/respond/route"},resolvedPagePath:"/Users/charllestabordas/Documents/SISTEMA DE CONTAS/app/api/chat/respond/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:u,staticGenerationAsyncStorage:m,serverHooks:p,headerHooks:g,staticGenerationBailout:h}=d,v="/api/chat/respond/route";function I(){return(0,t.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}},81664:(e,a,r)=>{r.d(a,{eI:()=>t,i3:()=>i,vv:()=>c});var o=r(77497),s=r(94128),n=r(32455);let t=(0,r(40002).cache)(async()=>{let e=await (0,n.cookies)();return(0,o.createServerClient)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{cookies:{getAll:()=>e.getAll(),setAll(a){try{a.forEach(({name:a,value:r,options:o})=>e.set(a,r,o))}catch{}}}})});function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return e?(0,s.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}}):null}function c(){return(0,s.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{auth:{autoRefreshToken:!1,persistSession:!1}})}},50482:(e,a,r)=>{e.exports=r(20399)},40002:(e,a,r)=>{e.exports=r(50482).vendored["react-rsc"].React},95419:(e,a,r)=>{e.exports=r(30517)}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),o=a.X(0,[1638,2455,4128,7497,8070],()=>r(33762));module.exports=o})();