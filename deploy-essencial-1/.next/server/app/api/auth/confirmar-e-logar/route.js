"use strict";(()=>{var e={};e.id=7199,e.ids=[7199],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56618:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>d,originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>f});var o={};s.r(o),s.d(o,{POST:()=>l});var t=s(95419),a=s(69108),n=s(99678),i=s(78070),c=s(81664),u=s(94128);async function l(e){try{let{email:r,password:s}=await e.json();if(!r||!s)return i.Z.json({error:"Email e senha s\xe3o obrigat\xf3rios"},{status:400});let o=(0,c.i3)();if(!o)return i.Z.json({error:"Service Role Key n\xe3o configurada. Configure SUPABASE_SERVICE_ROLE_KEY no .env.local"},{status:500});let{data:t,error:a}=await o.auth.admin.listUsers();if(a)return console.error("Erro ao listar usu\xe1rios:",a),i.Z.json({error:"Erro ao verificar usu\xe1rio"},{status:500});let n=t.users.find(e=>e.email?.toLowerCase()===r.toLowerCase());if(!n)return i.Z.json({error:"Email ou senha incorretos"},{status:401});let l=(0,u.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I"),{data:p,error:m}=await l.auth.signInWithPassword({email:r,password:s});if(m&&(m.message.includes("Email not confirmed")||m.message.includes("email_not_confirmed"))){console.log("⚠️ Email n\xe3o confirmado, confirmando via admin...");let{data:e,error:t}=await o.auth.admin.updateUserById(n.id,{email_confirm:!0});if(t)return console.error("Erro ao confirmar email via admin:",t),i.Z.json({error:"Erro ao confirmar email. Tente novamente."},{status:500});console.log("✅ Email confirmado via admin, tentando login novamente...");let{data:a,error:c}=await l.auth.signInWithPassword({email:r,password:s});if(c)return console.error("Erro no login ap\xf3s confirmar email:",c),i.Z.json({error:c.message||"Erro ao fazer login ap\xf3s confirmar email"},{status:401});if(!a.session||!a.user)return i.Z.json({error:"Erro ao criar sess\xe3o"},{status:500});return i.Z.json({success:!0,session:{access_token:a.session.access_token,refresh_token:a.session.refresh_token,expires_at:a.session.expires_at,expires_in:a.session.expires_in,token_type:a.session.token_type,user:a.user},user:a.user})}if(m)return i.Z.json({error:m.message||"Email ou senha incorretos"},{status:401});if(p?.session&&p?.user)return i.Z.json({success:!0,session:{access_token:p.session.access_token,refresh_token:p.session.refresh_token,expires_at:p.session.expires_at,expires_in:p.session.expires_in,token_type:p.session.token_type,user:p.user},user:p.user});return i.Z.json({error:"Erro ao processar login"},{status:500})}catch(e){return console.error("Erro na API confirmar-e-logar:",e),i.Z.json({error:e.message||"Erro interno do servidor"},{status:500})}}let p=new t.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/confirmar-e-logar/route",pathname:"/api/auth/confirmar-e-logar",filename:"route",bundlePath:"app/api/auth/confirmar-e-logar/route"},resolvedPagePath:"/Users/charllestabordas/Documents/SISTEMA DE CONTAS/app/api/auth/confirmar-e-logar/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:I,serverHooks:h,headerHooks:d,staticGenerationBailout:f}=p,g="/api/auth/confirmar-e-logar/route";function x(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:I})}},81664:(e,r,s)=>{s.d(r,{eI:()=>n,i3:()=>i,vv:()=>c});var o=s(77497),t=s(94128),a=s(32455);let n=(0,s(40002).cache)(async()=>{let e=await (0,a.cookies)();return(0,o.createServerClient)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:s,options:o})=>e.set(r,s,o))}catch{}}}})});function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return e?(0,t.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}}):null}function c(){return(0,t.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{auth:{autoRefreshToken:!1,persistSession:!1}})}},50482:(e,r,s)=>{e.exports=s(20399)},40002:(e,r,s)=>{e.exports=s(50482).vendored["react-rsc"].React},95419:(e,r,s)=>{e.exports=s(30517)}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),o=r.X(0,[1638,2455,4128,7497,8070],()=>s(56618));module.exports=o})();