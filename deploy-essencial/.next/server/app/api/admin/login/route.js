"use strict";(()=>{var e={};e.id=2672,e.ids=[2672],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},85622:(e,t,o)=>{o.r(t),o.d(t,{headerHooks:()=>j,originalPathname:()=>J,patchFetch:()=>P,requestAsyncStorage:()=>T,routeModule:()=>E,serverHooks:()=>Z,staticGenerationAsyncStorage:()=>A,staticGenerationBailout:()=>N});var r={};o.r(r),o.d(r,{POST:()=>S});var a=o(95419),s=o(69108),n=o(99678),i=o(78070),d=o(81664),l=o(1840),c=o(46508),h=o(72062),p=o(30979),u=o(11798),g=o(90927),m=o(71081);class y{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let o;if(!this._protectedHeader&&!this._unprotectedHeader)throw new p.GW("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,h.Z)(this._protectedHeader,this._unprotectedHeader))throw new p.GW("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let r={...this._protectedHeader,...this._unprotectedHeader},a=(0,m.Z)(p.GW,new Map([["b64",!0]]),t?.crit,this._protectedHeader,r),s=!0;if(a.has("b64")&&"boolean"!=typeof(s=this._protectedHeader.b64))throw new p.GW('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:n}=r;if("string"!=typeof n||!n)throw new p.GW('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,g.Y)(n,e,"sign");let i=this._payload;s&&(i=u.g7.encode((0,l.cv)(i))),o=this._protectedHeader?u.g7.encode((0,l.cv)(JSON.stringify(this._protectedHeader))):u.g7.encode("");let d=(0,u.zo)(o,u.g7.encode("."),i),y=await (0,c.Z)(n,e,d),f={signature:(0,l.cv)(y),payload:""};return s&&(f.payload=u.xv.decode(i)),this._unprotectedHeader&&(f.header=this._unprotectedHeader),this._protectedHeader&&(f.protected=u.xv.decode(o)),f}}class f{constructor(e){this._flattened=new y(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let o=await this._flattened.sign(e,t);if(void 0===o.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${o.protected}.${o.payload}.${o.signature}`}}var _=o(25331),b=o(19233),x=o(5653);function H(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}class I{constructor(e={}){if(!(0,b.Z)(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:H("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:H("setNotBefore",(0,_.Z)(e))}:this._payload={...this._payload,nbf:(0,_.Z)(new Date)+(0,x.Z)(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:H("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:H("setExpirationTime",(0,_.Z)(e))}:this._payload={...this._payload,exp:(0,_.Z)(new Date)+(0,x.Z)(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:(0,_.Z)(new Date)}:e instanceof Date?this._payload={...this._payload,iat:H("setIssuedAt",(0,_.Z)(e))}:"string"==typeof e?this._payload={...this._payload,iat:H("setIssuedAt",(0,_.Z)(new Date)+(0,x.Z)(e))}:this._payload={...this._payload,iat:H("setIssuedAt",e)},this}}class w extends I{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){let o=new f(u.g7.encode(JSON.stringify(this._payload)));if(o.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new p.uv("JWTs MUST NOT use unencoded payload");return o.sign(e,t)}}let v=new TextEncoder().encode(process.env.ADMIN_JWT_SECRET||"your-secret-key-change-in-production");async function S(e){try{let{email:t,password:r}=await e.json();if(!t||!r)return i.Z.json({error:"Email e senha s\xe3o obrigat\xf3rios"},{status:400});let a=await (0,d.eI)(),{data:s,error:n}=await a.from("admin_users").select("*").eq("email",t).eq("is_active",!0).limit(1);if(console.log("Admins encontrados:",s?.length||0),console.log("Erro ao buscar:",n),n)return console.error("Erro ao buscar admin:",n),i.Z.json({error:`Erro ao buscar usu\xe1rio: ${n.message}`},{status:500});if(!s||0===s.length)return console.log("Admin n\xe3o encontrado para email:",t),i.Z.json({error:"Email ou senha incorretos"},{status:401});let l=s[0];console.log("=== DEBUG LOGIN ==="),console.log("Admin encontrado:",{id:l.id,email:l.email,hash_length:l.password_hash?.length,hash_preview:l.password_hash?.substring(0,50)+"...",hash_full:l.password_hash}),console.log("Senha recebida:",r),console.log("Tipo da senha:",typeof r),console.log("Tamanho da senha:",r.length);let c=l.password_hash;Buffer.isBuffer(c)&&(c=c.toString("utf-8"),console.log("Hash era Buffer, convertido para string"));let h=c.trim().replace(/\s+/g,"");if(console.log("Hash limpo:",h),console.log("Hash limpo length:",h.length),!h||!h.includes(":"))return console.error("Hash inv\xe1lido no banco de dados"),i.Z.json({error:"Erro na configura\xe7\xe3o do banco de dados"},{status:500});let p=o(6113),u=h.replace(/[^a-f0-9:]/gi,""),[g,m]=u.split(":");if(console.log("Hash sanitizado:",u),console.log("Salt extra\xeddo:",g),console.log("Salt length:",g.length),console.log("Hash extra\xeddo:",m),console.log("Hash length:",m.length),!g||!m||32!==g.length||128!==m.length)return console.error("Hash em formato inv\xe1lido:",{salt_length:g?.length,hash_length:m?.length}),i.Z.json({error:"Erro na configura\xe7\xe3o do banco de dados"},{status:500});let y=p.pbkdf2Sync(r,g,1e4,64,"sha512").toString("hex");if(console.log("Hash calculado:",y),console.log("Hash calculado length:",y.length),console.log("Hashs s\xe3o iguais?",m===y),console.log("Primeiros 20 chars hash esperado:",m.substring(0,20)),console.log("Primeiros 20 chars hash calculado:",y.substring(0,20)),m!==y){console.log("❌ SENHA INV\xc1LIDA"),console.log("Compara\xe7\xe3o byte a byte:");for(let e=0;e<Math.min(m.length,y.length);e++)if(m[e]!==y[e]){console.log(`Diferen\xe7a na posi\xe7\xe3o ${e}: esperado '${m[e]}' (${m.charCodeAt(e)}), recebido '${y[e]}' (${y.charCodeAt(e)})`);break}return i.Z.json({error:"Email ou senha incorretos"},{status:401})}console.log("✅ SENHA V\xc1LIDA - Prosseguindo com cria\xe7\xe3o do token...");let f=await new w({id:l.id,email:l.email,nome:l.nome}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("24h").sign(v);return i.Z.json({success:!0,token:f,admin:{id:l.id,email:l.email,nome:l.nome}})}catch(e){return console.error("Erro no login admin:",e),i.Z.json({error:"Erro interno do servidor"},{status:500})}}let E=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/login/route",pathname:"/api/admin/login",filename:"route",bundlePath:"app/api/admin/login/route"},resolvedPagePath:"/Users/charllestabordas/Documents/SISTEMA DE CONTAS/app/api/admin/login/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:T,staticGenerationAsyncStorage:A,serverHooks:Z,headerHooks:j,staticGenerationBailout:N}=E,J="/api/admin/login/route";function P(){return(0,n.patchFetch)({serverHooks:Z,staticGenerationAsyncStorage:A})}},81664:(e,t,o)=>{o.d(t,{eI:()=>n,i3:()=>i,vv:()=>d});var r=o(77497),a=o(94128),s=o(32455);let n=(0,o(40002).cache)(async()=>{let e=await (0,s.cookies)();return(0,r.createServerClient)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:o,options:r})=>e.set(t,o,r))}catch{}}}})});function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return e?(0,a.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}}):null}function d(){return(0,a.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{auth:{autoRefreshToken:!1,persistSession:!1}})}},50482:(e,t,o)=>{e.exports=o(20399)},40002:(e,t,o)=>{e.exports=o(50482).vendored["react-rsc"].React},95419:(e,t,o)=>{e.exports=o(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[1638,2455,4128,7497,8070,5164],()=>o(85622));module.exports=r})();