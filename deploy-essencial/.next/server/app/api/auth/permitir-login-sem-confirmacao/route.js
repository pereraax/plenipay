"use strict";(()=>{var e={};e.id=6934,e.ids=[6934],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},26108:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>I,originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>f,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>h});var o={};s.r(o),s.d(o,{POST:()=>m});var a=s(95419),i=s(69108),t=s(99678),n=s(78070),c=s(81664),l=s(94128);async function m(e){try{let{email:r,password:s}=await e.json();if(!r||!s)return n.Z.json({error:"Email e senha s\xe3o obrigat\xf3rios"},{status:400});let o=(0,c.i3)();if(!o)return n.Z.json({error:"Service Role Key n\xe3o configurada. Configure SUPABASE_SERVICE_ROLE_KEY no .env.local"},{status:500});let{data:a,error:i}=await o.auth.admin.listUsers();if(i)return console.error("Erro ao listar usu\xe1rios:",i),n.Z.json({error:"Erro ao verificar usu\xe1rio"},{status:500});let t=a.users.find(e=>e.email?.toLowerCase()===r.toLowerCase());if(!t)return n.Z.json({error:"Email ou senha incorretos"},{status:401});let m=(0,l.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I"),{data:u,error:p}=await m.auth.signInWithPassword({email:r,password:s});if(u?.session&&u?.user)return n.Z.json({success:!0,session:{access_token:u.session.access_token,refresh_token:u.session.refresh_token,expires_at:u.session.expires_at,expires_in:u.session.expires_in,token_type:u.session.token_type,user:u.user},user:u.user,emailConfirmed:!0});if(p&&(p.message.includes("Email not confirmed")||p.message.includes("email_not_confirmed"))){console.log("⚠️ Email n\xe3o confirmado - criando sess\xe3o tempor\xe1ria permitindo acesso...");try{let{error:e}=await o.auth.admin.updateUserById(t.id,{email_confirm:!0});if(e)return console.error("Erro ao confirmar email temporariamente:",e),n.Z.json({error:"Erro ao criar sess\xe3o. Verifique se o Service Role Key est\xe1 configurado."},{status:500});let{data:a,error:i}=await m.auth.signInWithPassword({email:r,password:s});if(i||!a?.session)return await o.auth.admin.updateUserById(t.id,{email_confirm:!1}),n.Z.json({error:"Erro ao fazer login ap\xf3s criar sess\xe3o."},{status:401});let{error:c}=await o.auth.admin.updateUserById(t.id,{email_confirm:!1});if(c)console.error("⚠️ Erro ao desconfirmar email ap\xf3s criar sess\xe3o:",c);else{console.log("✅ Email desconfirmado novamente - status mantido como n\xe3o confirmado"),await new Promise(e=>setTimeout(e,500));let{data:e}=await o.auth.admin.getUserById(t.id);e?.user&&console.log("✅ Verifica\xe7\xe3o p\xf3s-desconfirma\xe7\xe3o:",{email_confirmed_at:e.user.email_confirmed_at,email_confirm:e.user.email_confirmed_at?"AINDA CONFIRMADO (erro!)":"DESCONFIRMADO (correto)"})}console.log("✅ Sess\xe3o criada com sucesso - email permanece n\xe3o confirmado"),console.log("\uD83D\uDC64 Usu\xe1rio da sess\xe3o:",a.user.id,a.user.email);let{data:l}=await o.auth.admin.getUserById(t.id);l?.user&&console.log("✅ Status do email ap\xf3s desconfirma\xe7\xe3o:",{email_confirmed_at:l.user.email_confirmed_at,email_confirm:l.user.email_confirmed_at?"confirmado":"n\xe3o confirmado"});let{data:u}=await o.from("profiles").select("id, email, plano, plano_status").eq("id",t.id).maybeSingle();u?(console.log("✅ Perfil encontrado:",{id:u.id,email:u.email,plano:u.plano,plano_status:u.plano_status}),u.plano&&"teste"!==u.plano&&!u.plano_status&&(console.log('⚠️ Plano n\xe3o \xe9 "teste" para novo usu\xe1rio, corrigindo...'),await o.from("profiles").update({plano:"teste",plano_status:null}).eq("id",t.id),console.log('✅ Plano corrigido para "teste"'))):console.warn("⚠️ Perfil n\xe3o encontrado ap\xf3s criar sess\xe3o");let p=l?.user||a.user;return n.Z.json({success:!0,session:{access_token:a.session.access_token,refresh_token:a.session.refresh_token,expires_at:a.session.expires_at,expires_in:a.session.expires_in,token_type:a.session.token_type,user:{...p,email_confirmed_at:null}},user:{...p,email_confirmed_at:null},emailConfirmed:!1})}catch(e){return console.error("Erro ao criar sess\xe3o tempor\xe1ria:",e),n.Z.json({error:"Erro ao criar sess\xe3o tempor\xe1ria. Tente confirmar seu email primeiro."},{status:500})}}return n.Z.json({error:p?.message||"Email ou senha incorretos"},{status:401})}catch(e){return console.error("Erro na API permitir-login-sem-confirmacao:",e),n.Z.json({error:e.message||"Erro interno do servidor"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/permitir-login-sem-confirmacao/route",pathname:"/api/auth/permitir-login-sem-confirmacao",filename:"route",bundlePath:"app/api/auth/permitir-login-sem-confirmacao/route"},resolvedPagePath:"/Users/charllestabordas/Documents/SISTEMA DE CONTAS/app/api/auth/permitir-login-sem-confirmacao/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:f,headerHooks:I,staticGenerationBailout:h}=u,g="/api/auth/permitir-login-sem-confirmacao/route";function _(){return(0,t.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:d})}},81664:(e,r,s)=>{s.d(r,{eI:()=>t,i3:()=>n,vv:()=>c});var o=s(77497),a=s(94128),i=s(32455);let t=(0,s(40002).cache)(async()=>{let e=await (0,i.cookies)();return(0,o.createServerClient)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:s,options:o})=>e.set(r,s,o))}catch{}}}})});function n(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return e?(0,a.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}}):null}function c(){return(0,a.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{auth:{autoRefreshToken:!1,persistSession:!1}})}},50482:(e,r,s)=>{e.exports=s(20399)},40002:(e,r,s)=>{e.exports=s(50482).vendored["react-rsc"].React},95419:(e,r,s)=>{e.exports=s(30517)}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),o=r.X(0,[1638,2455,4128,7497,8070],()=>s(26108));module.exports=o})();