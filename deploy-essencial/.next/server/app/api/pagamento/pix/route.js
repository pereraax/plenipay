"use strict";(()=>{var e={};e.id=5051,e.ids=[5051],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},93446:(e,o,t)=>{t.r(o),t.d(o,{headerHooks:()=>g,originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>I});var a={};t.r(a),t.d(a,{GET:()=>u});var s=t(95419),r=t(69108),n=t(99678),i=t(81664),c=t(84113),p=t(78070);async function u(e){try{let o=await (0,i.eI)(),{data:{user:t}}=await o.auth.getUser();if(!t)return p.Z.json({error:"N\xe3o autenticado"},{status:401});let{searchParams:a}=new URL(e.url),s=a.get("subscriptionId");if(!s)return p.Z.json({error:"ID da assinatura n\xe3o fornecido"},{status:400});console.log("Buscando pagamentos para subscription:",s);let r=await (0,c.LJ)(s);if(console.log("Pagamentos encontrados:",r?.length||0),!r||0===r.length)return console.log("Nenhum pagamento encontrado, retornando erro"),p.Z.json({success:!1,error:"Pagamento ainda n\xe3o foi gerado. Aguarde alguns instantes e tente novamente."},{status:404});let n=r[0];console.log("Primeiro pagamento ID:",n.id);let u=await (0,c._N)(n.id);console.log("Detalhes do pagamento:",{id:u.id,status:u.status,billingType:u.billingType,hasPixCopiaECola:!!u.pixCopiaECola,hasPixQrCodeId:!!u.pixQrCodeId});let l=null,d=null;if(d=u.pixCopiaECola||u.pixCopyPaste,console.log("C\xf3digo PIX encontrado:",!!d),u.pixQrCodeId)try{console.log("Buscando QR code com ID:",u.pixQrCodeId);let e=process.env.ASAAS_API_URL||"https://www.asaas.com/api/v3",o=process.env.ASAAS_API_KEY.trim();o.startsWith("\\$")&&(o=o.substring(1)),console.log("\uD83D\uDD0D Buscando QR code PIX em:",`${e}/payments/${n.id}/pixQrCode`);let t=await fetch(`${e}/payments/${n.id}/pixQrCode`,{headers:{access_token:o}});if(console.log("Resposta do QR code:",t.status),t.ok){let e=await t.json();console.log("Dados do QR code recebidos:",Object.keys(e)),l=e.encodedImage||e.base64||e.qrCode,d||(d=e.payload||e.pixCopyPaste)}else{let e=await t.text();console.error("Erro ao buscar QR code:",t.status,e)}}catch(e){console.error("Erro ao buscar QR code:",e)}return console.log("Resultado final:",{hasQrCode:!!l,hasCopyPaste:!!d}),p.Z.json({success:!0,pixQrCode:l,pixCopyPaste:d,paymentId:n.id})}catch(e){return console.error("Erro ao buscar pagamento PIX:",e),p.Z.json({error:e.message||"Erro ao buscar pagamento PIX"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/pagamento/pix/route",pathname:"/api/pagamento/pix",filename:"route",bundlePath:"app/api/pagamento/pix/route"},resolvedPagePath:"/Users/charllestabordas/Documents/SISTEMA DE CONTAS/app/api/pagamento/pix/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:g,staticGenerationBailout:I}=l,x="/api/pagamento/pix/route";function y(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},84113:(e,o,t)=>{t.d(o,{LJ:()=>p,_N:()=>u,lA:()=>r,oJ:()=>i,y5:()=>n,zU:()=>c});let a=process.env.ASAAS_API_URL||"https://sandbox.asaas.com/api/v3",s=process.env.ASAAS_API_KEY;async function r(e){let o=await fetch(`${a}/customers`,{method:"POST",headers:{"Content-Type":"application/json",access_token:s},body:JSON.stringify(e)});if(!o.ok){let e=await o.json();throw Error(e.errors?.[0]?.description||e.message||"Erro ao criar customer")}return o.json()}async function n(e){let o=await fetch(`${a}/subscriptions`,{method:"POST",headers:{"Content-Type":"application/json",access_token:s},body:JSON.stringify(e)});if(!o.ok){let e=await o.json();throw Error(e.errors?.[0]?.description||e.message||"Erro ao criar assinatura")}return o.json()}async function i(e){let o=await fetch(`${a}/customers/${e}`,{headers:{access_token:s}});if(!o.ok)throw Error("Erro ao buscar customer");return o.json()}async function c(e,o){let t=await fetch(`${a}/customers/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",access_token:s},body:JSON.stringify(o)});if(!t.ok){let e=await t.json();throw Error(e.errors?.[0]?.description||e.message||"Erro ao atualizar customer")}return t.json()}async function p(e){let o=await fetch(`${a}/subscriptions/${e}/payments`,{headers:{access_token:s}});if(!o.ok)throw Error("Erro ao buscar pagamentos da assinatura");return(await o.json()).data||[]}async function u(e){let o=await fetch(`${a}/payments/${e}`,{headers:{access_token:s}});if(!o.ok)throw Error("Erro ao buscar pagamento");return o.json()}},81664:(e,o,t)=>{t.d(o,{eI:()=>n,i3:()=>i,vv:()=>c});var a=t(77497),s=t(94128),r=t(32455);let n=(0,t(40002).cache)(async()=>{let e=await (0,r.cookies)();return(0,a.createServerClient)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{cookies:{getAll:()=>e.getAll(),setAll(o){try{o.forEach(({name:o,value:t,options:a})=>e.set(o,t,a))}catch{}}}})});function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return e?(0,s.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}}):null}function c(){return(0,s.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{auth:{autoRefreshToken:!1,persistSession:!1}})}},50482:(e,o,t)=>{e.exports=t(20399)},40002:(e,o,t)=>{e.exports=t(50482).vendored["react-rsc"].React},95419:(e,o,t)=>{e.exports=t(30517)}};var o=require("../../../../webpack-runtime.js");o.C(e);var t=e=>o(o.s=e),a=o.X(0,[1638,2455,4128,7497,8070],()=>t(93446));module.exports=a})();