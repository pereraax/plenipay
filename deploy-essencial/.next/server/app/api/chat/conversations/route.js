"use strict";(()=>{var e={};e.id=7499,e.ids=[7499],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},85722:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>h,originalPathname:()=>_,patchFetch:()=>g,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>I});var r={};s.r(r),s.d(r,{GET:()=>u});var a=s(95419),o=s(69108),n=s(99678),i=s(81664),c=s(78070);async function u(e){try{let e=await (0,i.eI)(),{data:{user:t}}=await e.auth.getUser();if(!t)return c.Z.json({error:"N\xe3o autenticado"},{status:401});let{data:s,error:r}=await e.rpc("get_chat_conversations");if(r){console.error("Erro ao buscar conversas:",r);let{data:t,error:s}=await e.from("chat_messages").select(`
          user_id,
          message,
          created_at,
          sender_type,
          is_read,
          profiles:user_id (
            email,
            nome
          )
        `).order("created_at",{ascending:!1});if(s)return c.Z.json({error:"Erro ao buscar conversas"},{status:500});let a=new Map;return t?.forEach(e=>{a.has(e.user_id)||a.set(e.user_id,{user_id:e.user_id,user_email:e.profiles?.email||"N/A",user_name:e.profiles?.nome||"Usu\xe1rio",last_message:e.message,last_message_time:e.created_at,unread_count:0,total_messages:0});let t=a.get(e.user_id);t.total_messages++,!e.is_read&&"user"===e.sender_type&&t.unread_count++,new Date(e.created_at)>new Date(t.last_message_time)&&(t.last_message=e.message,t.last_message_time=e.created_at)}),c.Z.json({conversations:Array.from(a.values())})}return c.Z.json({conversations:s||[]})}catch(e){return console.error("Erro inesperado:",e),c.Z.json({error:"Erro inesperado ao buscar conversas"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/chat/conversations/route",pathname:"/api/chat/conversations",filename:"route",bundlePath:"app/api/chat/conversations/route"},resolvedPagePath:"/Users/charllestabordas/Documents/SISTEMA DE CONTAS/app/api/chat/conversations/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:m,headerHooks:h,staticGenerationBailout:I}=p,_="/api/chat/conversations/route";function g(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},81664:(e,t,s)=>{s.d(t,{eI:()=>n,i3:()=>i,vv:()=>c});var r=s(77497),a=s(94128),o=s(32455);let n=(0,s(40002).cache)(async()=>{let e=await (0,o.cookies)();return(0,r.createServerClient)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:s,options:r})=>e.set(t,s,r))}catch{}}}})});function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return e?(0,a.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}}):null}function c(){return(0,a.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{auth:{autoRefreshToken:!1,persistSession:!1}})}},50482:(e,t,s)=>{e.exports=s(20399)},40002:(e,t,s)=>{e.exports=s(50482).vendored["react-rsc"].React},95419:(e,t,s)=>{e.exports=s(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,2455,4128,7497,8070],()=>s(85722));module.exports=r})();