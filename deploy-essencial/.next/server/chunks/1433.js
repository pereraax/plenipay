"use strict";exports.id=1433,exports.ids=[1433],exports.modules={91433:(e,a,r)=>{r.r(a),r.d(a,{atualizarRegistro:()=>c,coletarBauMeta:()=>y,criarDepositoCofrinho:()=>q,criarEmprestimo:()=>_,criarMetaCofrinho:()=>b,criarRegistro:()=>s,criarUsuario:()=>p,editarMetaCofrinho:()=>I,excluirMetaCofrinho:()=>w,excluirRegistro:()=>n,marcarParcelaPaga:()=>d,obterBausMetaCofrinho:()=>N,obterDividas:()=>g,obterEmprestimos:()=>h,obterEstatisticas:()=>v,obterMetasCofrinho:()=>P,obterRegistros:()=>u,obterUsuarios:()=>m,pagarDivida:()=>l,resetarMetaCofrinho:()=>U,resetarTodosRegistros:()=>f});var t=r(74471);r(68616);var o=r(81664),i=r(66864);async function s(e){try{let a;let r=await (0,o.eI)(),t=e.get("valor");if(t.includes(",")){let e=t.replace(/\./g,"").replace(",",".");a=parseFloat(e)}else if(t.includes(".")){if(t.split(".").length>2){let e=t.replace(/\./g,"");a=parseFloat(e)}else a=parseFloat(t)}else a=parseFloat(t);if(isNaN(a))return{error:"Valor inv\xe1lido. N\xe3o foi poss\xedvel converter o valor informado."};if(isNaN(a)||a<=0)return{error:"Valor inv\xe1lido. Deve ser um n\xfamero maior que zero."};let s=e.get("user_id");if(!s)return{error:"Usu\xe1rio n\xe3o selecionado."};let c=e.get("nome");if(!c||!c.trim())return{error:"Nome do registro \xe9 obrigat\xf3rio."};let n=Math.round(100*a)/100,d={user_id:s,nome:c.trim(),observacao:e.get("observacao")||null,tipo:e.get("tipo"),valor:n,categoria:e.get("categoria")||null,etiquetas:JSON.parse(e.get("etiquetas")||"[]"),parcelas_totais:parseInt(e.get("parcelas_totais")||"1"),parcelas_pagas:parseInt(e.get("parcelas_pagas")||"0"),data_registro:e.get("data_registro")||new Date().toISOString()};"true"===e.get("is_recorrente")&&(d.is_recorrente=!0,d.recorrencia_tipo=e.get("recorrencia_tipo")||null,d.recorrencia_dia=e.get("recorrencia_dia")?parseInt(e.get("recorrencia_dia")):null,d.recorrencia_dia_semana=e.get("recorrencia_dia_semana")?parseInt(e.get("recorrencia_dia_semana")):null,d.proxima_recorrencia=e.get("proxima_recorrencia")||null,d.ativo="true"===e.get("ativo"));let{data:l,error:u}=await r.from("registros").insert([d]).select().single();if(u)return console.error("Erro ao inserir registro no Supabase:",u),{error:u.message};return(0,i.revalidateTag)("estatisticas"),(0,i.revalidatePath)("/home"),(0,i.revalidatePath)("/registros"),(0,i.revalidatePath)("/dividas"),(0,i.revalidatePath)("/calendario"),(0,i.revalidatePath)("/dashboard"),{data:l}}catch(e){return console.error("Erro ao criar registro:",e),{error:e.message||"Erro desconhecido ao criar registro"}}}async function c(e,a){let r;let t=await (0,o.eI)(),s=a.get("valor");if(isNaN(r=s.includes(",")?parseFloat(s.replace(/\./g,"").replace(",",".")):parseFloat(s))||r<=0)return{error:"Valor inv\xe1lido"};let{data:c,error:n}=await t.from("registros").update({nome:a.get("nome"),observacao:a.get("observacao")||null,tipo:a.get("tipo"),valor:Math.round(100*r)/100,categoria:a.get("categoria")||null,etiquetas:JSON.parse(a.get("etiquetas")||"[]"),parcelas_totais:parseInt(a.get("parcelas_totais")||"1"),parcelas_pagas:parseInt(a.get("parcelas_pagas")||"0"),data_registro:a.get("data_registro")}).eq("id",e).select().single();return n?{error:n.message}:((0,i.revalidateTag)("estatisticas"),(0,i.revalidatePath)("/"),(0,i.revalidatePath)("/registros"),(0,i.revalidatePath)("/dividas"),(0,i.revalidatePath)("/calendario"),(0,i.revalidatePath)("/dashboard"),{data:c})}async function n(e){let a=await (0,o.eI)(),{data:{user:r}}=await a.auth.getUser();if(!r)return{error:"N\xe3o autenticado"};console.log("\uD83D\uDDD1️ [excluirRegistro] Excluindo registro:",e,"Usu\xe1rio:",r.id);let{data:t,error:s}=await a.from("registros").select("id, user_id, tipo").eq("id",e).maybeSingle();if(s)return console.error("❌ [excluirRegistro] Erro ao buscar registro:",s),{error:s.message};if(!t)return console.warn("⚠️ [excluirRegistro] Registro n\xe3o encontrado:",e),{error:"Registro n\xe3o encontrado"};if(console.log("\uD83D\uDCCB [excluirRegistro] Registro encontrado:",{id:t.id,user_id:t.user_id,tipo:t.tipo,usuario_autenticado:r.id}),!(!t.user_id||t.user_id===r.id||"divida"===t.tipo))return console.warn("⚠️ [excluirRegistro] Usu\xe1rio n\xe3o tem permiss\xe3o para excluir este registro",{registro_user_id:t.user_id,usuario_autenticado:r.id,tipo:t.tipo}),{error:"Voc\xea n\xe3o tem permiss\xe3o para excluir este registro"};console.log("✅ [excluirRegistro] Permiss\xe3o confirmada, prosseguindo com exclus\xe3o");let{error:c,data:n}=await a.from("registros").delete().eq("id",e).select();return c?(console.error("❌ [excluirRegistro] Erro ao excluir:",c),{error:c.message}):(console.log("✅ [excluirRegistro] Registro exclu\xeddo com sucesso:",n),(0,i.revalidateTag)("estatisticas"),(0,i.revalidateTag)("registros"),(0,i.revalidateTag)("dividas"),(0,i.revalidatePath)("/"),(0,i.revalidatePath)("/registros"),(0,i.revalidatePath)("/dividas"),(0,i.revalidatePath)("/calendario"),(0,i.revalidatePath)("/dashboard"),(0,i.revalidatePath)("/home"),{success:!0,data:n})}async function d(e){let a=await (0,o.eI)(),{data:r}=await a.from("registros").select("parcelas_pagas, parcelas_totais").eq("id",e).single();if(!r)return{error:"Registro n\xe3o encontrado"};let t=Math.min(r.parcelas_pagas+1,r.parcelas_totais),{data:s,error:c}=await a.from("registros").update({parcelas_pagas:t}).eq("id",e).select().single();return c?{error:c.message}:((0,i.revalidatePath)("/"),(0,i.revalidatePath)("/registros"),(0,i.revalidatePath)("/dividas"),(0,i.revalidatePath)("/calendario"),(0,i.revalidatePath)("/dashboard"),{data:s})}async function l(e,a,r){try{let t=await (0,o.eI)(),{data:s,error:c}=await t.from("registros").select("valor, parcelas_totais, parcelas_pagas, observacao").eq("id",e).single();if(c||!s)return{error:"Registro n\xe3o encontrado"};let n=s.valor*(s.parcelas_pagas/s.parcelas_totais)+a,d=s.valor,l=Math.min(Math.ceil(n/d*s.parcelas_totais),s.parcelas_totais),u=s.observacao||"[]",g=[];try{g=JSON.parse(u)}catch{}g.push({valor:a,data:r});let{data:m,error:p}=await t.from("registros").update({parcelas_pagas:l,observacao:JSON.stringify(g)}).eq("id",e).select().single();if(p)return{error:p.message};return(0,i.revalidateTag)("estatisticas"),(0,i.revalidatePath)("/"),(0,i.revalidatePath)("/registros"),(0,i.revalidatePath)("/dividas"),(0,i.revalidatePath)("/calendario"),(0,i.revalidatePath)("/dashboard"),{data:m}}catch(e){return console.error("Erro ao pagar d\xedvida:",e),{error:e.message||"Erro ao pagar d\xedvida"}}}async function u(e={}){let a=await (0,o.eI)(),{data:{user:r}}=await a.auth.getUser();if(!r)return{data:[],error:"N\xe3o autenticado"};let t=a.from("registros").select("*").eq("user_id",r.id).order("data_registro",{ascending:!1});e.nome&&(t=t.ilike("nome",`%${e.nome}%`)),e.tipo&&(t=t.eq("tipo",e.tipo)),e.etiquetas&&Array.isArray(e.etiquetas)&&e.etiquetas.length>0&&(t=t.contains("etiquetas",e.etiquetas)),e.data_inicio&&(t=t.gte("data_registro",e.data_inicio)),e.data_fim&&(t=t.lte("data_registro",e.data_fim));let{data:i,error:s}=await t;return s?(console.error("Erro ao buscar registros:",s),{data:[],error:s.message}):{data:i||[]}}async function g(){let e=await (0,o.eI)(),{data:{user:a}}=await e.auth.getUser();if(!a)return{data:[],error:"N\xe3o autenticado"};let{data:r,error:t}=await e.from("registros").select("*").eq("tipo","divida").eq("user_id",a.id).order("data_registro",{ascending:!1});return t?(console.error("Erro ao buscar d\xedvidas:",t),{data:[],error:t.message}):{data:r||[]}}async function m(){let e=await (0,o.eI)(),{data:{user:a}}=await e.auth.getUser();if(!a)return{data:[],error:"N\xe3o autenticado"};let{data:r,error:t}=await e.from("users").select("*").order("nome",{ascending:!0});return t?{data:[],error:t.message}:{data:r||[]}}async function p(e){let a=await (0,o.eI)(),r=e.get("nome");if(!r||!r.trim())return{error:"Nome \xe9 obrigat\xf3rio"};let{data:t,error:s}=await a.from("users").insert([{nome:r.trim()}]).select().single();return s?{error:s.message}:((0,i.revalidatePath)("/configuracoes"),(0,i.revalidateTag)("usuarios"),{data:t})}async function f(){let e=await (0,o.eI)(),{data:{user:a}}=await e.auth.getUser();if(!a)return{error:"N\xe3o autenticado"};let{error:r}=await e.from("registros").delete().neq("id","00000000-0000-0000-0000-000000000000");return r?{error:r.message}:((0,i.revalidateTag)("estatisticas"),(0,i.revalidatePath)("/"),(0,i.revalidatePath)("/registros"),(0,i.revalidatePath)("/dividas"),(0,i.revalidatePath)("/calendario"),(0,i.revalidatePath)("/dashboard"),{success:!0})}async function v(){let e=await (0,o.eI)(),{data:{user:a}}=await e.auth.getUser();if(!a)return{error:"N\xe3o autenticado"};let{data:r,error:t}=await e.from("registros").select("tipo, valor, parcelas_totais, parcelas_pagas, user_id").eq("user_id",a.id);if(t)return console.error("Erro ao buscar estat\xedsticas:",t),{error:t.message};let i=0,s=0,c=0,n=0;return r?.forEach(e=>{if("entrada"===e.tipo)i+=Number(e.valor);else if("saida"===e.tipo)s+=Number(e.valor);else if("divida"===e.tipo){c+=Number(e.valor);let a=Number(e.valor)*e.parcelas_pagas/e.parcelas_totais;n+=a}}),{totalEntradas:i,totalSaidas:s,totalDividas:c,dividasPagas:n,totalDividasPendentes:c-n,saldo:i-s}}async function _(e){let a=await (0,o.eI)(),r=parseFloat(e.get("valor")),t=parseInt(e.get("parcelas_totais")||"1"),s=new Date(e.get("data_emprestimo")),c=new Date(e.get("data_pagamento")),n=e.get("parcelas");if(n)try{JSON.parse(n)}catch(e){}let d={nome_pessoa:e.get("nome_pessoa"),valor:r,observacao:e.get("observacao")||null,cpf:e.get("cpf")||null,celular:e.get("celular")||null,arquivo_url:e.get("arquivo_url")||null,data_emprestimo:s.toISOString(),data_pagamento:c.toISOString(),parcelas_totais:t,parcelas_pagas:0},{data:l,error:u}=await a.from("emprestimos").insert([d]).select().single();if(u)return{error:u.message};let g=[],m=r/t;if(t>1){let e=Math.round(Math.ceil((c.getTime()-s.getTime())/864e5)/t);for(let a=0;a<t;a++){let r=new Date(s);0===a?r.setTime(s.getTime()):a===t-1?r.setTime(c.getTime()):r.setDate(r.getDate()+e*(a+1)),g.push({nome:`Empr\xe9stimo - ${d.nome_pessoa} - Parcela ${a+1}/${t}`,observacao:`Parcela ${a+1} de ${t} do empr\xe9stimo para ${d.nome_pessoa}`,tipo:"divida",valor:m,categoria:"Empr\xe9stimo",etiquetas:["empr\xe9stimo",d.nome_pessoa.toLowerCase().replace(/\s+/g,"-")],parcelas_totais:t,parcelas_pagas:0,data_registro:r.toISOString()})}await a.from("registros").insert(g)}else await a.from("registros").insert([{nome:`Empr\xe9stimo - ${d.nome_pessoa}`,observacao:d.observacao||`Empr\xe9stimo para ${d.nome_pessoa}`,tipo:"divida",valor:r,categoria:"Empr\xe9stimo",etiquetas:["empr\xe9stimo",d.nome_pessoa.toLowerCase().replace(/\s+/g,"-")],parcelas_totais:1,parcelas_pagas:0,data_registro:c.toISOString()}]);return(0,i.revalidatePath)("/"),(0,i.revalidatePath)("/calendario"),(0,i.revalidatePath)("/registros"),(0,i.revalidatePath)("/dividas"),{data:l}}async function h(){let e=await (0,o.eI)(),{data:a,error:r}=await e.from("emprestimos").select("*").order("data_emprestimo",{ascending:!1});return r?{data:[],error:r.message}:{data:a||[]}}async function b(e){let a=await (0,o.eI)(),{data:{user:r}}=await a.auth.getUser();if(!r)return{error:"N\xe3o autenticado"};let t={user_id:r.id,nome:e.get("nome"),meta_total:parseFloat(e.get("valor_objetivo")),valor_acumulado:0,periodicidade:e.get("periodicidade"),data_inicio:new Date().toISOString()},{data:s,error:c}=await a.from("metas_cofrinho").insert([t]).select().single();return c?{error:c.message}:((0,i.revalidatePath)("/minhas-metas"),{data:s})}async function I(e,a){let r=await (0,o.eI)(),{data:t,error:s}=await r.from("metas_cofrinho").update({nome:a.get("nome"),meta_total:parseFloat(a.get("valor_objetivo")),periodicidade:a.get("periodicidade")}).eq("id",e).select().single();return s?{error:s.message}:((0,i.revalidatePath)("/minhas-metas"),{data:t})}async function w(e){let a=await (0,o.eI)(),{error:r}=await a.from("metas_cofrinho").delete().eq("id",e);return r?{error:r.message}:((0,i.revalidatePath)("/minhas-metas"),{success:!0})}async function P(){let e=await (0,o.eI)(),{data:{user:a}}=await e.auth.getUser();if(!a)return{data:[],error:"N\xe3o autenticado"};let{data:r,error:t}=await e.from("metas_cofrinho").select("*").eq("user_id",a.id).order("data_inicio",{ascending:!1});return t?{data:[],error:t.message}:{data:r||[]}}async function q(e,a,r){let t=await (0,o.eI)(),{data:{user:s}}=await t.auth.getUser();if(!s)return{error:"N\xe3o autenticado"};if(!e)return{error:"ID da meta n\xe3o fornecido"};let c=r?a-r:a,{data:n,error:d}=await t.from("metas_cofrinho").select("id, valor_acumulado, user_id").eq("id",e).eq("user_id",s.id).single();if(d)return console.error("Erro ao buscar meta:",d),{error:`Erro ao buscar meta: ${d.message}`};if(!n)return console.error("Meta n\xe3o encontrada:",{metaId:e,userId:s.id}),{error:"Meta n\xe3o encontrada ou voc\xea n\xe3o tem permiss\xe3o para acess\xe1-la"};let l=Number(n.valor_acumulado||0)+c,{data:u,error:g}=await t.from("metas_cofrinho").update({valor_acumulado:l}).eq("id",e).select().single();return g?{error:g.message}:(await t.from("depositos_cofrinho").insert({meta_id:e,valor:c,desconto:r||0,data_deposito:new Date().toISOString()}),(0,i.revalidatePath)("/minhas-metas"),{data:u})}async function N(e){let a=await (0,o.eI)(),{data:r,error:t}=await a.from("baus_meta").select("*").eq("meta_id",e).order("numero_bau",{ascending:!0});return t?{data:[],error:t.message}:{data:r||[]}}async function y(e,a){let r=await (0,o.eI)(),{data:t,error:s}=await r.from("baus_meta").update({coletado:!0,desconto_aplicado:a,data_coleta:new Date().toISOString()}).eq("id",e).select().single();return s?{error:s.message}:((0,i.revalidatePath)("/minhas-metas"),{data:t})}async function U(e){let a=await (0,o.eI)();return await a.from("metas_cofrinho").update({valor_acumulado:0}).eq("id",e),await a.from("depositos_cofrinho").delete().eq("meta_id",e),await a.from("baus_meta").update({coletado:!1,desconto_aplicado:0,data_coleta:null}).eq("meta_id",e),(0,i.revalidatePath)("/minhas-metas"),{success:!0}}(0,r(42053).h)([s,c,n,d,l,u,g,m,p,f,v,_,h,b,I,w,P,q,N,y,U]),(0,t.U)("230f57158249c34d410702e12e5ed20109a82cb5",s),(0,t.U)("331e00a8bd55fbc4647894e75deb9d622e65262b",c),(0,t.U)("7a5812df7fa537449e30af8482b959119bb5a3b9",n),(0,t.U)("189acde9d8ba09cf1fa4502a831d11adfdef214a",d),(0,t.U)("1c6f6257e327d1a8298c81a2c176b2cf4f67c259",l),(0,t.U)("c2c5c8dc8a684f1448fe15864b09bb63a503a1f0",u),(0,t.U)("0a9ef55d10fe0c4ac929c2a10460a36a857f415e",g),(0,t.U)("05ebcbba5892735c1439f199b8d0bb629920a73c",m),(0,t.U)("515d1ab9d9a146a826a501e3cbfac0b203edf4ac",p),(0,t.U)("c57ff1267c026993a0b18696f79e908f72fbb6ab",f),(0,t.U)("8a3728cd313d0e727c1792c87e6ea0e6968cbfbf",v),(0,t.U)("9cf5ff030e23581d3720e53c2dc93d2fe8cf283c",_),(0,t.U)("38ec628be9394ddc2becfcdf37826b7d2bab44a1",h),(0,t.U)("7af002ae1f9efeacd79c403b3fa388cff4789c53",b),(0,t.U)("5aaa6054274ead32c9c2f1bfde761a706bb325fc",I),(0,t.U)("f4f80106626033d46b812b45e7973e34bc6c73f6",w),(0,t.U)("55c7e515dbccb193beccc282665c7cd0068bb3f0",P),(0,t.U)("0305e3a8646bd650b9adafe954666989ab036d34",q),(0,t.U)("028c880afc441a7abca2ca63f71e47d33a85bc72",N),(0,t.U)("d7385b3e8fa7fcedf5527c95854e0457bfbb991c",y),(0,t.U)("0677e679ab9ad88dcae5f5ed21d3e091a8ece2a2",U)},81664:(e,a,r)=>{r.d(a,{eI:()=>s,i3:()=>c,vv:()=>n});var t=r(77497),o=r(94128),i=r(32455);let s=(0,r(40002).cache)(async()=>{let e=await (0,i.cookies)();return(0,t.createServerClient)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{cookies:{getAll:()=>e.getAll(),setAll(a){try{a.forEach(({name:a,value:r,options:t})=>e.set(a,r,t))}catch{}}}})});function c(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return e?(0,o.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}}):null}function n(){return(0,o.eI)("https://frhxqgcqmxpjpnghsvoe.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyaHhxZ2NxbXhwanBuZ2hzdm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTM3NTYsImV4cCI6MjA3OTIyOTc1Nn0.p1OxLRA5DKgvetuy-IbCfYClNSjrvK6fm43aZNX3T7I",{auth:{autoRefreshToken:!1,persistSession:!1}})}}};